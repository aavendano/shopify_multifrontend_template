---
import CardMedia from './CardMedia.astro';
import CardContent from './CardContent.astro';
import Button from '../atoms/Button.astro';

interface Props {
  productId: string;
  title: string;
  image: string;
  price: number | string;
  compareAtPrice?: number | string;
  currency?: string;
  badgeText?: string;
  href: string;
  quantity?: number;
  lowStockThreshold?: number;
  showQuickAdd?: boolean;
}

const {
  productId,
  title,
  image,
  price,
  compareAtPrice,
  currency,
  badgeText,
  href,
  quantity,
  lowStockThreshold,
  showQuickAdd = false,
} = Astro.props;
---

<div class="product-card card is-hoverable has-shadow is-flex is-flex-direction-column" data-product-id={productId}>
  <a href={href} class="is-block">
    <CardMedia
      src={image}
      alt={title}
      badgeText={badgeText}
      aspectRatio="square"
    />
  </a>

  <div class="p-4 is-flex is-flex-direction-column is-justify-content-space-between is-flex-grow-1">
    <a href={href} class="has-text-black">
      <CardContent
        title={title}
        price={price}
        compareAtPrice={compareAtPrice}
        currency={currency}
        quantity={quantity}
        lowStockThreshold={lowStockThreshold}
      />
    </a>

    {showQuickAdd && (
      <div class="mt-4">
        <Button
          variant="primary"
          fullWidth={true}
          class="quick-add-btn"
        >
          Add to Cart
        </Button>
      </div>
    )}
  </div>
</div>

<script>
  document.querySelectorAll('.product-card').forEach(card => {
    const btn = card.querySelector('.quick-add-btn');
    if (btn) {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();

        const productId = card.getAttribute('data-product-id');

        card.dispatchEvent(new CustomEvent('add-to-cart', {
          detail: { productId },
          bubbles: true
        }));
      });
    }
  });
</script>
