---
import Image from '../atoms/Image.astro';

interface Props {
  images: string[];
  currentImage: string;
  class?: string;
}

const { images, currentImage, class: className } = Astro.props;
---

<div class={`product-gallery ${className || ''}`}>
  <div class="main-image mb-4">
    <Image
      src={currentImage}
      alt="Product Image"
      ratio="square"
      class="border rounded"
    />
  </div>

  <div class="columns is-mobile is-multiline m-0">
    {images.map((img, index) => (
      <div class="column is-one-fifth p-1">
        <button
          type="button"
          class={`thumbnail-btn button is-white p-0 is-clickable is-fullwidth ${img === currentImage ? 'is-primary is-selected' : ''}`}
          data-src={img}
          data-index={index}
          aria-label={`View image ${index + 1}`}
        >
          <Image
            src={img}
            alt={`Thumbnail ${index + 1}`}
            ratio="square"
            class="rounded border"
          />
        </button>
      </div>
    ))}
  </div>
</div>

<script>
  const gallery = document.querySelector('.product-gallery');
  if (gallery) {
    gallery.querySelectorAll('.thumbnail-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const src = btn.getAttribute('data-src');

        gallery.dispatchEvent(new CustomEvent('image-change', {
          detail: { src },
          bubbles: true
        }));
      });
    });
  }
</script>
