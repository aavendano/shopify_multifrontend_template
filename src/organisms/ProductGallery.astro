---
import Image from '../atoms/Image.astro';

interface Props {
  images: string[];
  currentImage: string;
  class?: string;
}

const { images, currentImage, class: className } = Astro.props;
---

<div class={`product-gallery ${className || ''}`}>
  <div class="main-image mb-4">
    <Image
      src={currentImage}
      alt="Product Image"
      ratio="square"
      class="border rounded"
    />
  </div>

  <div class="thumbnails is-flex is-flex-wrap-wrap m-neg-1">
    {images.map((img, index) => (
      <button
        type="button"
        class={`thumbnail-btn p-1 border-0 bg-transparent ${img === currentImage ? 'is-active' : ''}`}
        data-src={img}
        data-index={index}
        aria-label={`View image ${index + 1}`}
      >
        <Image
          src={img}
          alt={`Thumbnail ${index + 1}`}
          ratio="square"
          width={80}
          height={80}
          class="rounded border"
        />
      </button>
    ))}
  </div>
</div>

<style lang="scss">
  @use "../styles/tokens" as *;

  .m-neg-1 {
    margin: -$token-spacing-xs;
  }
  .thumbnail-btn {
    width: 20%;
    cursor: pointer;
    transition: transform $token-transition-base;
  }
  .thumbnail-btn:hover {
    transform: scale(1.05);
  }
  .thumbnail-btn.is-active img {
    border-color: var(--bulma-primary);
    border-width: $token-radius-sm;
  }
</style>

<script>
  const gallery = document.querySelector('.product-gallery');
  if (gallery) {
    gallery.querySelectorAll('.thumbnail-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const src = btn.getAttribute('data-src');

        gallery.dispatchEvent(new CustomEvent('image-change', {
          detail: { src },
          bubbles: true
        }));
      });
    });
  }
</script>
